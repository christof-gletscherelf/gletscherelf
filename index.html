<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Gletscherelf Bewegungsprofil</title>
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    img {
      max-width: 100%;
      max-height: 100%;
    }

    #heatmapContainerWrapper {
      width: 100%;
      height: 100%;
      position: absolute;
    }

    #heatmapContainer {
      width: 100%;
      height: 100%;
    }

    #drag {
      max-width: 90%;
    }
  </style>
  <link rel="stylesheet" href="slider/nouislider.css">
  <link rel="stylesheet" href="slider/nouislider.tooltips.css">
</head>

<body>
  <div id="heatmapContainerWrapper">
    <div id="heatmapContainer">
      <img id="footballfield" src="images/bg.jpg" />
    </div>
  </div>

  <div id="drag" />
  <input id="fromMinute" />
  <input id="toMinute" />



  <script src="/build/heatmap.js"></script>
  <script src="slider/nouislider.js"></script>
  <script src="wnumb/wNumb.js"></script>
  <script>
    window.onload = function() {
        // create a heatmap instance
        var heatmap = h337.create({
          container: document.getElementById('heatmapContainer'),
          maxOpacity: .6,
          radius: 50,
          blur: 0.9,
        });
        var heatmapContainer = document.getElementById('heatmapContainerWrapper');

        var dragSlider = document.getElementById('drag');

        var img = document.getElementById('footballfield');
        var fieldWidth = img.clientWidth;
        var fieldHeight = img.clientHeight;

        noUiSlider.create(dragSlider, {
          start: [10, 20],
          behaviour: 'drag',
          connect: true,
          range: {
            'min': 0,
            'max': 90
          },
          format: wNumb({
            decimals: 0,
          })
        });

        var fromMinute = document.getElementById('fromMinute');
        var toMinute = document.getElementById('toMinute');

        var wholeGameCoordinates = [];
        wholeGameCoordinates = generateWholeGameData(5400);

        function deviateCoordinateFromLen(len, max) {
          var random = Math.random();
          var linearPart = (5400 - len);
          var randomPart = max * random;
          var quota = len / max;
          var normalizedLinearPart = linearPart / quota / 2;
          var normalizedRandomPart = randomPart / quota / 2;
          var result = (normalizedLinearPart * 0.8) + (normalizedRandomPart * 0.2);
          return result >> 0;
        }

        function generateWholeGameData(len) {
          var max = 1;
          var min = 1;
          var maxX = fieldWidth;
          var maxY = fieldHeight;
          var data = [];
          while (len--) {
            data.push({
              x: deviateCoordinateFromLen(len, maxX),
              y: deviateCoordinateFromLen(len, maxY),
              value: 1
            });
          }
          return {
            max: max,
            min: min,
            data: data
          }
        };

        function getPartialGameCoordinates(from, to) {
          var partialGameCoordinates = {};
          partialGameCoordinates.max = wholeGameCoordinates.max;
          partialGameCoordinates.min = wholeGameCoordinates.min;
          partialGameCoordinates.data = wholeGameCoordinates.data.slice(from * 60, to * 60);
          return partialGameCoordinates;
        }

        dragSlider.noUiSlider.on('update', function(values, handle) {
          fromMinute.value = values[0];
          toMinute.value = values[1];
          heatmap.setData(getPartialGameCoordinates(fromMinute.value, toMinute.value));
          heatmap.repaint();

        });


      }
  </script>
</body>

</html>
